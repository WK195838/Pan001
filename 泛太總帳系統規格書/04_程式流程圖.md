# 泛太總帳系統程式流程圖

## 1. 系統登入流程

```
開始
  │
  ↓
進入系統登入頁面 (AuthAD.aspx)
  │
  ↓
輸入使用者名稱和密碼
  │
  ↓
<是否啟用 AD 驗證?>
  │       │
  │是     │否
  ↓       ↓
Windows AD 驗證 → 內部帳號驗證
  │               │
  ↓               ↓
<驗證是否成功?>
  │       │
  │成功   │失敗
  ↓       ↓
載入使用者權限 → 顯示錯誤訊息
  │               │
  ↓               ↓
進入系統首頁     返回登入頁
  │
  ↓
結束
```

## 2. 薪資計算主流程

```
開始
  │
  ↓
選擇計薪年月和期別
  │
  ↓
<是否已執行過計薪?>
  │       │
  │是     │否
  ↓       ↓
詢問是否重新計算 → 準備計薪資料
  │               │
  ↓               ↓
<確認重新計算?>   讀取員工名單
  │       │       │
  │是     │否     ↓
  ↓       ↓       進行薪資計算
  │       結束    │
  ↓               ↓
清除舊計算結果    儲存計算結果
  │               │
  ↓               ↓
  └───→ 顯示計算結果
                  │
                  ↓
              結束
```

## 3. 單一員工薪資計算流程

```
開始 (GetOnePayroll)
  │
  ↓
讀取員工基本資料
  │
  ↓
計算基本薪資 (GetFixedSalary)
  │
  ↓
計算計薪天數 (GetPaydays)
  │
  ↓
<是否為破月到職或離職?>
  │       │
  │是     │否
  ↓       ↓
計算比例薪資 → 使用全月薪資
  │           │
  ↓           ↓
計算請假扣薪 (GetLeaveHoursDeduction)
  │
  ↓
計算加班費 (GetWTOverTime)
  │
  ↓
計算勞保費 (LaborInsurance)
  │
  ↓
計算健保費 (HealthInsurance)
  │
  ↓
計算所得稅 (IncomeTax)
  │
  ↓
計算退休金 (RetirementPension)
  │
  ↓
計算其他薪資項目
  │
  ↓
計算總計金額
  │
  ↓
儲存計算結果
  │
  ↓
結束
```

## 4. 薪資單產生流程

```
開始 (PayrollToPDF)
  │
  ↓
選擇公司、年月和員工
  │
  ↓
<是否為批次處理?>
  │       │
  │是     │否
  ↓       ↓
取得員工清單 → 取得單一員工資料
  │           │
  ↓           ↓
循環處理每位員工 → 產生單一薪資單
  │               │
  ↓               ↓
產生多份薪資單    產生 PDF 檔案
  │               │
  ↓               ↓
建立 ZIP 壓縮檔   <是否設定密碼?>
  │               │       │
  │               │是     │否
  │               ↓       ↓
  │           加密 PDF → 直接下載
  │               │       │
  │               ↓       ↓
  └───→ 提供下載連結
                  │
                  ↓
              記錄下載日誌
                  │
                  ↓
                結束
```

## 5. 年度資料統計流程

```
開始
  │
  ↓
選擇統計年度
  │
  ↓
讀取所有月份資料
  │
  ↓
計算年度薪資總額
  │
  ↓
計算年度勞健保費用
  │
  ↓
計算年度所得稅
  │
  ↓
產生所得稅申報資料
  │
  ↓
產生年度報表
  │
  ↓
結束
```

## 6. 權限控制流程

```
開始 (CheckPermission)
  │
  ↓
獲取目前使用者資訊
  │
  ↓
取得目標功能 ID
  │
  ↓
<是否為系統管理員?>
  │       │
  │是     │否
  ↓       ↓
允許存取 → 檢查功能權限
          │
          ↓
      <是否有權限?>
          │       │
          │是     │否
          ↓       ↓
      允許存取   拒絕存取
          │       │
          ↓       ↓
      返回結果   顯示錯誤訊息
                  │
                  ↓
                結束
```

## 7. 資料加密流程

```
開始 (EnCodeAmount)
  │
  ↓
接收要加密的金額
  │
  ↓
取得加密金鑰
  │
  ↓
轉換資料格式
  │
  ↓
應用加密演算法
  │
  ↓
返回加密後的字串
  │
  ↓
結束
```

## 8. 薪資確認流程

```
開始 (ConfirmDraftPayroll)
  │
  ↓
取得薪資計算結果
  │
  ↓
執行資料檢核
  │
  ↓
<資料是否正確?>
  │       │
  │是     │否
  ↓       ↓
執行確認程序 → 顯示錯誤訊息
  │           │
  ↓           ↓
更新薪資狀態 → 返回錯誤代碼
  │
  ↓
產生確認報表
  │
  ↓
記錄確認日誌
  │
  ↓
結束
``` 