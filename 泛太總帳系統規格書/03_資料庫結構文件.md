# 泛太總帳系統資料庫結構文件

## 資料庫基本資訊

- **資料庫名稱**：EBOSDB
- **資料庫伺服器**：PANTECH-MSSQL\SQLEXPRESS
- **資料庫使用者**：PPDB
- **連接字串**：在 Web.Config 中定義

## 主要資料表結構

根據系統程式碼分析，以下是主要資料表結構的推斷。實際資料表可能有所不同，此處僅根據程式碼使用情況進行推測。

### 1. 薪資相關資料表

#### 1.1 PayrollWorking (薪資工作表)
- **用途**：儲存薪資計算過程的臨時資料
- **主要欄位**：
  - Company：公司代碼
  - EmployeeId：員工編號
  - SalaryYM：薪資年月
  - PeriodCode：期別代碼
  - 各項薪資計算欄位

#### 1.2 PayrolltestWorking (薪資測試工作表)
- **用途**：用於測試環境的薪資計算
- **結構**：與 PayrollWorking 相同

#### 1.3 相關資料表
- **薪資項目表**：儲存各項薪資項目定義
- **薪資期間表**：管理薪資計算期間
- **薪資級距表**：定義各薪資級距

### 2. 員工資料相關資料表

#### 2.1 員工基本資料表
- **用途**：儲存員工基本資料
- **主要欄位**：
  - EmployeeId：員工編號
  - Company：公司代碼
  - Name：姓名
  - IDNo：身分證號
  - ResignCode：離職狀態
  - HireDate：到職日期
  - ResignDate：離職日期
  - 其他基本資料欄位

#### 2.2 員工薪資資料表
- **用途**：儲存員工薪資設定資料
- **主要欄位**：
  - EmployeeId：員工編號
  - BaseSalary：底薪
  - PayCode：計薪別
  - 各項津貼設定

### 3. 勞健保相關資料表

#### 3.1 勞保資料表
- **用途**：儲存勞保相關資料
- **主要欄位**：
  - 勞保投保級距
  - 勞保費率

#### 3.2 健保資料表
- **用途**：儲存健保相關資料
- **主要欄位**：
  - 健保投保級距
  - 健保費率
  - 眷屬資料

#### 3.3 眷屬資料表
- **用途**：儲存員工眷屬資料
- **主要欄位**：
  - EmployeeId：員工編號
  - DependentIDNo：眷屬身分證號
  - Relationship：關係
  - 其他相關資料

### 4. 系統管理相關資料表

#### 4.1 使用者權限表
- **用途**：儲存使用者權限設定
- **主要欄位**：
  - UserId：使用者ID
  - ProgramId：程式ID
  - Permission：權限設定

#### 4.2 系統設定表
- **用途**：儲存系統參數設定
- **主要欄位**：
  - 各項系統參數

#### 4.3 操作日誌表
- **用途**：記錄系統操作日誌
- **主要欄位**：
  - 操作時間
  - 操作用戶
  - 操作內容
  - IP位址

### 5. 其他相關資料表

#### 5.1 Holiday_t (假日資料表)
- **用途**：儲存各國假日資料
- **主要欄位**：
  - holiday：假日日期
  - countryID：國家代碼

#### 5.2 UC_Program (程式功能表)
- **用途**：儲存系統功能定義
- **主要欄位**：
  - ProgramId：程式ID
  - SiteId：網站ID
  - ProgramName：程式名稱
  - ProgramPath：程式路徑
  - ProgramDesc：程式描述

## 資料庫關聯圖

```
[PayrollWorking] -----> [員工基本資料表]
       |
       |-----> [薪資項目表]
       |
       |-----> [薪資期間表]
       
[員工基本資料表] -----> [員工薪資資料表]
       |
       |-----> [眷屬資料表]
       
[使用者權限表] -----> [UC_Program]
```

## 資料存取方式

系統主要通過以下方式存取資料庫：

1. **DBManger 類別**：
   - 在 `App_Code/DBManger.cs` 中定義
   - 提供通用的資料庫操作方法

2. **存儲過程**：
   - `sp_view_Menu`：用於查詢選單資料
   - `sp_PY_ConfirmDraftPayroll`：用於確認薪資計算結果

3. **SQL 語句**：
   - 部分功能直接使用 SQL 語句存取資料庫

## 資料安全機制

1. **權限控制**：
   - 基於角色的資料存取控制
   - 不同用戶僅能存取授權的資料

2. **資料加密**：
   - 敏感資料使用加密儲存
   - 薪資資料使用編碼機制保護

3. **操作日誌**：
   - 記錄所有重要資料操作
   - 提供資料異動追蹤 