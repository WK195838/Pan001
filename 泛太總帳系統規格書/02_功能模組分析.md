# 泛太總帳系統功能模組分析

## 1. 薪資計算核心模組

### 1.1 基本薪資計算
- **功能說明**：處理員工的基本薪資計算，包括底薪、各項津貼
- **程式檔案**：`App_Code/Payroll.cs`
- **主要方法**：
  - `GetFixedSalary`：計算固定薪資
  - `GetPaydays`：計算計薪天數
  - `GetOnePayroll`：處理單一員工的薪資計算
- **計算規則**：
  - 破月計薪採用比例計算
  - 依據每月實際天數計算日薪基數
  - 離職人員特殊處理機制

### 1.2 加班費計算
- **功能說明**：處理各類加班的計算，包括一般加班、假日加班等
- **程式檔案**：`App_Code/Payroll.cs`
- **主要方法**：
  - `GetWTOverTime`：取得加班資料並計算
  - `GetWTOverTime1`：計算時薪加班
- **計算規則**：
  - 區分應稅加班與免稅加班
  - 支援不同加班倍率計算
  - 依員工薪資級別計算加班費基數

### 1.3 請假扣薪處理
- **功能說明**：處理各類請假的扣薪計算
- **程式檔案**：`App_Code/Payroll.cs`
- **主要方法**：
  - `GetLeaveHours`：取得請假時數
  - `GetLeaveHoursDeduction`：計算請假扣薪金額
- **計算規則**：
  - 區分不同假別的扣薪規則
  - 支援扣薪計算至小數點第二位
  - 特殊假別不扣薪規則處理

## 2. 勞健保處理模組

### 2.1 勞保計算
- **功能說明**：計算員工的勞保費用
- **程式檔案**：`App_Code/LaborInsurance.cs`
- **計算規則**：
  - 依據勞保投保級距計算費用
  - 破月到職/離職的勞保費比例計算
  - 處理勞保費分攤比例

### 2.2 健保計算
- **功能說明**：計算員工及眷屬的健保費用
- **程式檔案**：`App_Code/HealthInsurance.cs`
- **計算規則**：
  - 依據健保投保級距計算費用
  - 眷屬健保費計算
  - 特殊規則：當月離職者健保費處理機制

## 3. 所得稅處理模組

### 3.1 所得稅計算
- **功能說明**：計算員工薪資所得稅
- **程式檔案**：`App_Code/IncomeTax.cs`
- **計算規則**：
  - 支援不同稅率設定
  - 應稅與免稅項目區分
  - 外籍人士特殊稅率處理

### 3.2 年度所得彙總
- **功能說明**：年度所得彙總與申報資料準備
- **相關功能**：所得稅各式表單產生

## 4. 薪資單產生模組

### 4.1 薪資單產生
- **功能說明**：產生各類型薪資單
- **程式檔案**：
  - `Payroll/PayrollToPDF.aspx`
  - `Payroll/PayrollToPDF.aspx.cs`
- **主要功能**：
  - 支援不同格式薪資單
  - 批次產生多人薪資單
  - 加密保護機制

### 4.2 PDF轉換與下載
- **功能說明**：將薪資資料轉換為PDF格式並提供下載
- **程式檔案**：
  - `Payroll/PayrollToPDF.aspx.cs`
- **主要方法**：
  - `DownLoadPDF`：處理PDF下載
- **特色功能**：
  - PDF密碼保護
  - 支援批次下載
  - 郵件發送功能

## 5. 系統管理模組

### 5.1 權限管理
- **功能說明**：管理使用者權限與存取控制
- **程式檔案**：
  - `App_Code/UserInfo.cs`
  - `AuthAD.aspx.cs`
- **主要功能**：
  - Windows AD整合驗證
  - 基於角色的權限控制
  - 功能層級的權限設定

### 5.2 系統設定
- **功能說明**：管理系統各項參數設定
- **程式檔案**：
  - `App_Code/SysSetting.cs`
  - `Web.Config`
- **主要功能**：
  - 公司基本資料設定
  - 薪資計算參數設定
  - 系統環境設定

### 5.3 日誌記錄
- **功能說明**：記錄系統操作日誌
- **程式檔案**：相關功能分散在各模組中
- **主要功能**：
  - 使用者登入記錄
  - 薪資計算操作記錄
  - 資料異動記錄

## 6. 員工自助服務模組

### 6.1 個人薪資查詢
- **功能說明**：員工查詢個人薪資資料
- **程式檔案**：
  - `MyPayroll/MyPayrollToPDF.aspx`
  - `MyPayroll/MyPayrollToPDF.aspx.cs`
- **主要功能**：
  - 個人薪資歷史查詢
  - 薪資單下載
  - 個人薪資分析

### 6.2 個人基本資料維護
- **功能說明**：員工維護個人基本資料
- **主要功能**：
  - 基本資料更新
  - 眷屬資料維護
  - 稅籍資料設定 