# CalendarMonth 月份控制項規格書

## 基本資訊

| 項目       | 內容                                    |
|------------|---------------------------------------|
| 程式代號     | CalendarMonth                         |
| 程式名稱     | 月份控制項                               |
| 檔案大小     | 1.4KB                                 |
| 行數        | ~40                                   |
| 功能簡述     | 提供月份選擇功能                          |
| 複雜度       | 中                                    |
| 規格書狀態   | 已完成                                 |
| 負責人員     | Claude AI                             |
| 完成日期     | 2025/5/7                              |

## 程式功能概述

CalendarMonth 是泛太總帳系統中的月份選擇控制項，提供使用者在報表查詢、資料篩選等功能中選擇特定月份的功能。此控制項廣泛應用於需要指定月份的場景，如月報表查詢、月結作業等。主要功能包括：

1. 提供月份下拉選擇功能（1-12月）
2. 支援預設月份的設定
3. 可選擇是否顯示月份標籤
4. 提供月份的範圍限制功能（如限制只能選擇1-6月）
5. 可與年度控制項整合，實現完整的年月選擇
6. 提供月份變更的事件處理
7. 支援使用者自訂月份顯示格式（數字或中文）
8. 可設定控制項是否為必填項
9. 提供樣式自訂選項，以配合系統整體界面風格

## 控制項結構說明

CalendarMonth 的結構按功能可分為以下區域：

1. **使用者控制項宣告區**：定義控制項的基本屬性和行為
2. **視覺元素區**：包含標籤和下拉式月份選單
3. **屬性和方法區**：提供對外部存取和操作的介面
4. **事件處理區**：處理控制項內各元素的事件和互動
5. **驗證區**：實現必填項驗證等功能

## 頁面元素

### ASCX 頁面宣告

```html
<%@ Control Language="C#" AutoEventWireup="true" CodeFile="CalendarMonth.ascx.cs" Inherits="CalendarMonth" %>
```

### 頁面結構

頁面包含以下主要部分：

1. **引用相關控制項和元件**：
   - System.Web.UI 命名空間的標準控制項
   - ASP.NET AJAX 命名空間的擴充控制項

2. **視覺元素**：
   - 月份標籤 (lblMonth)
   - 月份下拉式選單 (ddlMonth)

3. **CSS 樣式區**：
   - 控制項外觀的樣式定義
   - 下拉式選單的樣式設定
   - 標籤的位置和對齊方式設定

## 技術實現

CalendarMonth 採用以下技術：

1. ASP.NET Web Forms 使用者控制項架構
2. ASP.NET AJAX 擴充控制項功能
3. 客戶端 JavaScript 功能（月份選擇事件處理）
4. 伺服器端事件處理
5. CSS 樣式定義和管理

## 依賴關係

CalendarMonth 依賴以下檔案與元件：

1. CalendarMonth.ascx.cs：月份控制項後端程式碼
2. System.Web.UI.WebControls：提供基本網頁控制項功能
3. System.Web.UI.HtmlControls：提供 HTML 控制項功能

## 使用者介面

CalendarMonth 的使用者介面由以下部分組成：

1. **月份標籤**：
   - 顯示「月份」標籤
   - 可自訂標籤文字和樣式
   - 可選擇是否顯示標籤

2. **月份下拉式選單**：
   - 提供 1-12 月份供選擇
   - 可客製化顯示格式（如數字「01」或中文「一月」）
   - 支援月份範圍限制

3. **整體布局**：
   - 控制項以水平排列方式顯示各元素
   - 標籤和下拉式選單對齊
   - 適當的間距和邊框樣式，確保使用者體驗一致性

## 控制項屬性

CalendarMonth 提供以下主要屬性：

1. **SelectedMonth**：
   - 類型：int
   - 功能：取得或設定選取的月份（1-12）
   - 預設值：當前系統月份

2. **DisplayFormat**：
   - 類型：enum (Numeric, ChineseCharacter)
   - 功能：設定月份顯示格式（數字或中文）
   - 預設值：Numeric

3. **MinMonth**：
   - 類型：int
   - 功能：設定可選擇的最小月份
   - 預設值：1

4. **MaxMonth**：
   - 類型：int
   - 功能：設定可選擇的最大月份
   - 預設值：12

5. **Required**：
   - 類型：bool
   - 功能：指定月份選擇是否為必填項
   - 預設值：true

6. **ShowLabel**：
   - 類型：bool
   - 功能：指定是否顯示月份標籤
   - 預設值：true

7. **LabelText**：
   - 類型：string
   - 功能：設定標籤顯示文字
   - 預設值：「月份」

8. **LabelWidth**：
   - 類型：int
   - 功能：設定標籤寬度（像素）
   - 預設值：60

9. **DropDownWidth**：
   - 類型：int
   - 功能：設定下拉式選單寬度（像素）
   - 預設值：80

10. **Enabled**：
    - 類型：bool
    - 功能：取得或設定控制項是否可用
    - 預設值：true

## 控制項方法

控制項提供以下主要方法：

1. **BindMonths**：
   - 功能：綁定月份資料到下拉式選單
   - 參數：顯示格式（可選）、月份範圍（可選）

2. **SelectMonth**：
   - 功能：根據月份值選取下拉式選單項目
   - 參數：月份值

3. **GetMonthDisplay**：
   - 功能：根據指定的月份值和顯示格式，獲取對應的顯示文字
   - 參數：月份值、顯示格式
   - 返回：月份顯示文字

4. **Validate**：
   - 功能：驗證控制項是否符合必填要求
   - 參數：無
   - 返回：驗證結果（布林值）

5. **Reset**：
   - 功能：重設控制項為預設狀態
   - 參數：無

## 事件處理

控制項包含以下事件處理：

1. **SelectedIndexChanged**：
   - 觸發條件：使用者選擇不同的月份時
   - 行為：更新選取的月份值，觸發 MonthChanged 事件

2. **MonthChanged**：
   - 觸發條件：月份選擇變更時
   - 行為：外部程式可以訂閱此事件，以便在月份變更時執行相應操作，如更新相關控制項或重新載入資料

## 使用範例

以下是 CalendarMonth 控制項的基本使用方式：

```html
<!-- 在 ASPX 頁面中引用控制項 -->
<uc:CalendarMonth ID="monthSelector" runat="server" 
    LabelText="報表月份" 
    LabelWidth="70" 
    DropDownWidth="100" 
    DisplayFormat="ChineseCharacter"
    OnMonthChanged="monthSelector_MonthChanged" />

<!-- 在程式碼中操作控制項 -->
<script runat="server">
    protected void Page_Load(object sender, EventArgs e)
    {
        if (!IsPostBack)
        {
            // 設定預設月份
            monthSelector.SelectedMonth = DateTime.Now.Month;
            
            // 設定月份範圍（例如：只允許選擇 1-6 月）
            monthSelector.MinMonth = 1;
            monthSelector.MaxMonth = 6;
        }
    }
    
    protected void monthSelector_MonthChanged(object sender, EventArgs e)
    {
        // 取得選取的月份
        int selectedMonth = monthSelector.SelectedMonth;
        
        // 執行月份變更相關操作...
        LoadMonthlyData(selectedMonth);
    }
    
    private void LoadMonthlyData(int month)
    {
        // 載入與月份相關的資料...
    }
</script>
```

## 異常處理

控制項包含以下異常處理機制：

1. **月份範圍驗證**：
   - 處理月份超出有效範圍的情況
   - 確保選取的月份值在 MinMonth 和 MaxMonth 之間

2. **必填項驗證**：
   - 當 Required 屬性設為 true 時，確保使用者選擇了有效的月份
   - 顯示適當的錯誤訊息

3. **預設值處理**：
   - 當找不到預設月份或預設月份無效時，選擇當前系統月份或範圍內的第一個有效月份

## 效能考量

1. **資料載入優化**：
   - 月份資料是固定的（1-12），可以直接在客戶端產生，無需資料庫查詢
   - 控制項初始化時一次性載入所有月份資料

2. **使用者體驗優化**：
   - 確保月份選擇操作的響應速度
   - 可使用 AJAX 更新相關控制項，避免整頁重新載入

## 安全性考量

1. **輸入驗證**：
   - 確保選取的月份值是有效的
   - 防止透過修改請求參數選擇無效的月份

2. **跨站腳本攻擊防護**：
   - 對月份顯示內容進行適當的編碼
   - 防止惡意腳本注入

## 測試記錄

測試項目包括：

1. **功能測試**：
   - 月份資料載入和顯示功能
   - 月份選擇和變更事件的觸發
   - 預設值設定的正確性

2. **介面測試**：
   - 控制項在各種瀏覽器下的渲染一致性
   - 控制項樣式與系統整體設計的協調性
   - 測試在不同螢幕尺寸下的顯示效果

3. **整合測試**：
   - 與年度控制項的協同工作
   - 月份切換後相關功能的正確更新
   - 在多種表單和頁面中的使用情境

## 待改進事項

1. 增加月份與年度的聯動功能，實現完整的年月選擇
2. 實現季度選擇功能，可自動對應到相應的月份
3. 增加更多的月份顯示格式，如英文月份名稱
4. 優化控制項在移動設備上的使用體驗
5. 增加更多自訂外觀的選項
6. 提供在同一個控制項中同時選擇年月的整合功能

## 維護記錄

| 日期      | 版本   | 變更內容                             | 變更人員    |
|-----------|--------|-------------------------------------|------------|
| 2025/5/7  | 1.0    | 首次建立月份控制項規格書              | Claude AI  | 